<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Auto</title>
    <link rel="stylesheet" href="/style/index.css">
</head>
<body>

    <div class="current-time" id="current-time"></div>

    <div class="sidebar">
        <div class="sidebar-header">
            Project Auto
        </div>
        <ul class="sidebar-list">
            <li><a href="/">Home</a></li>
            <li><a href="/Configuration">Configuration</a></li>
            <li><a href="/About-Us">About Us</a></li>
        </ul>
    </div>

    <div id="auth-modal" class="hidden">
        <div id="auth-modal-content">
            <h2>Authenticate with GitHub</h2>
            <form id="auth-form">
                <label for="github_username">GitHub Username:</label>
                <input type="text" id="github_username" name="github_username" required>
                <button type="button" class="auth-button" onclick="authenticateGitHub()">Authenticate</button>
                <button type="button" class="close-button" onclick="closeAuthModal()">Close</button>
            </form>
        </div>
    </div>

    <div class="content" id="main-content">
        <h1>Welcome to Project Auto</h1>
        <p>Enter your GitHub repository and customization instructions below:</p>

        <button class="github-button" onclick="openAuthModal()">Authenticate with GitHub</button>
        <button class="logout-button" onclick="logoutGitHub()" style="display:none;">Logout</button>
        <span id="username-display"></span>

        <div id="repo-form" class="repo-form">
            <label for="repo_name">Repository (username/repo):</label>
            <input type="text" id="repo_name" name="repo_name" placeholder="username/repo" required>
        </div>

        <div id="prompt-input" class="prompt-input">
            <label for="prompt">Customization Instructions:</label>
            <textarea id="prompt" name="prompt" placeholder="Enter your instructions here" rows="4" required></textarea>
        </div>

        <button class="start-button" onclick="startProjectAuto()">Start</button>

        <div id="response-display"></div>
    </div>

    <div class="loading-overlay hidden">
        <div class="loader"></div>
    </div>

    <footer>
        <p>Project Auto &copy; 2024</p>
    </footer>

    <script>
        function updateTime() {
            const currentTimeElement = document.getElementById("current-time");
            if (currentTimeElement) {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                currentTimeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }

        setInterval(updateTime, 1000);
        updateTime();

        let githubUsername = localStorage.getItem('githubUsername') || '';
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' || false;

        function openAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
        }

        function authenticateGitHub() {
            githubUsername = document.getElementById('github_username').value;
            localStorage.setItem('githubUsername', githubUsername);
            localStorage.setItem('isLoggedIn', 'true');
            isLoggedIn = true;
            updateAuthUI();
            closeAuthModal();
        }

        function logoutGitHub() {
            localStorage.removeItem('githubUsername');
            localStorage.setItem('isLoggedIn', 'false');
            githubUsername = '';
            isLoggedIn = false;
            updateAuthUI();
        }

        function updateAuthUI() {
            const githubButton = document.querySelector('.github-button');
            const logoutButton = document.querySelector('.logout-button');
            const usernameDisplay = document.getElementById('username-display');

            if (isLoggedIn) {
                githubButton.style.display = 'none';
                logoutButton.style.display = 'inline-block';
                usernameDisplay.textContent = `Logged in as ${githubUsername}`;
            } else {
                githubButton.style.display = 'inline-block';
                logoutButton.style.display = 'none';
                usernameDisplay.textContent = '';
            }
        }

        updateAuthUI();

        async function startProjectAuto() {
            const repoName = document.getElementById('repo_name').value;
            const prompt = document.getElementById('prompt').value;
            const responseDisplay = document.getElementById('response-display');
            const loadingOverlay = document.querySelector('.loading-overlay');

            if (!repoName || !prompt) {
                alert('Please fill in all fields.');
                return;
            }

            if (!isLoggedIn) {
                alert('Please authenticate with GitHub first.');
                return;
            }

            loadingOverlay.classList.remove('hidden');
            responseDisplay.textContent = 'Processing...';

            try {
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        repo: repoName,
                        prompt: prompt,
                        username: githubUsername
                    }),
                });

                const data = await response.json();

                if (response.ok) {
                    responseDisplay.textContent = data.message;
                } else {
                    responseDisplay.textContent = `Error: ${data.message}`;
                }
            } catch (error) {
                console.error('Error:', error);
                responseDisplay.textContent = `An error occurred: ${error.message}`;
            } finally {
                loadingOverlay.classList.add('hidden');
            }
        }
    </script>
</body>
</html>