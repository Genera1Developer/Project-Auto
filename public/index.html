<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Auto</title>
    <link rel="stylesheet" href="/style/index.css">
</head>
<body>
    <div class="current-time" id="current-time"></div>
    <div class="sidebar">
        <div class="sidebar-header">
            Project Auto
        </div>
        <ul class="sidebar-list">
            <li><a href="/">Home</a></li>
            <li><a href="/Configuration">Configuration</a></li>
            <li><a href="/About-Us">About Us</a></li>
            <li>
                <button id="auth-button" class="auth-button">Authenticate with GitHub</button>
                <button id="logout-button" class="logout-button hidden">Logout</button>
            </li>
        </ul>
    </div>

    <div id="auth-modal" class="hidden">
        <div id="auth-modal-content">
            <h2>GitHub Authentication</h2>
            <p>Please enter your GitHub username:</p>
            <form id="auth-form">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
                <button type="submit" class="auth-button">Authenticate</button>
            </form>
            <button class="close-button" id="close-auth-modal">Close</button>
        </div>
    </div>

    <div class="main-content">
        <section id="showcase">
            <div class="container">
                <h1>Welcome to Project Auto</h1>
                <p>Automate your development workflow with ease.</p>
            </div>
        </section>

        <section class="container">
            <div id="repo-form" class="repo-form">
                <label for="repo-url">GitHub Repository (username/repo):</label>
                <input type="text" id="repo-url" name="repo-url" placeholder="e.g., Project-Auto/Project-Auto">
            </div>

            <div id="prompt-input" class="prompt-input">
                <label for="prompt">Customization Prompt:</label>
                <textarea id="prompt" name="prompt" placeholder="Enter your customization instructions here."></textarea>
            </div>

            <button id="start-button" class="start-button">Start</button>

            <div id="response-display"></div>
        </section>
    </div>

    <div class="loading-overlay hidden">
        <div class="loader"></div>
    </div>

    <footer>
        <p>Project Auto, Copyright &copy; 2024</p>
    </footer>

    <script>
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('current-time').textContent = timeString;
        }

        setInterval(updateTime, 1000);
        updateTime();

        const authButton = document.getElementById('auth-button');
        const logoutButton = document.getElementById('logout-button');
        const authModal = document.getElementById('auth-modal');
        const closeAuthModal = document.getElementById('close-auth-modal');
        const authForm = document.getElementById('auth-form');
        const usernameInput = document.getElementById('username');
        let githubUsername = localStorage.getItem('githubUsername');
        const responseDisplay = document.getElementById('response-display');
        const loadingOverlay = document.querySelector('.loading-overlay');

        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        function updateAuthUI() {
            if (githubUsername) {
                authButton.classList.add('hidden');
                logoutButton.classList.remove('hidden');
                usernameInput.value = githubUsername;
            } else {
                authButton.classList.remove('hidden');
                logoutButton.classList.add('hidden');
                usernameInput.value = '';
            }
        }

        authButton.addEventListener('click', () => {
            authModal.classList.remove('hidden');
        });

        closeAuthModal.addEventListener('click', () => {
            authModal.classList.add('hidden');
        });

        authForm.addEventListener('submit', (event) => {
            event.preventDefault();
            githubUsername = usernameInput.value;
            localStorage.setItem('githubUsername', githubUsername);
            authModal.classList.add('hidden');
            updateAuthUI();
        });

        logoutButton.addEventListener('click', () => {
            githubUsername = null;
            localStorage.removeItem('githubUsername');
            updateAuthUI();
        });

        updateAuthUI();

        document.getElementById('start-button').addEventListener('click', async () => {
            const repoUrl = document.getElementById('repo-url').value;
            const prompt = document.getElementById('prompt').value;

            if (!githubUsername) {
                alert("Please authenticate with GitHub first.");
                return;
            }

            if (!repoUrl) {
                alert("Please enter a repository URL.");
                return;
            }

            showLoading();
            responseDisplay.textContent = 'Processing...';

            try {
                const response = await fetch('/api/process-repo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        repoUrl: repoUrl,
                        prompt: prompt,
                        username: githubUsername
                    }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                responseDisplay.textContent = data.message;
            } catch (error) {
                console.error('Error:', error);
                responseDisplay.textContent = `Error: ${error.message}`;
            } finally {
                hideLoading();
            }
        });
    </script>
</body>
</html>